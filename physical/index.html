<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ID・PIN生成多機能アプリ</title>
    <!-- Beer CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/beercss@3.5.1/dist/beercss.min.css">
    <!-- Material Design Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <style>
        body {
            font-family: var(--font, 'Inter', 'Noto Sans JP', sans-serif);
            /* BeerCSS handles body background with data-theme */
        }

        /* Header adjustments if necessary */
        header nav h5.max { /* Ensure title is well-aligned */
            margin: 0;
            line-height: inherit; /* Align with button */
        }

        /*
           BeerCSS v3.5.1 uses `div.drawer` typically inside `body > main.responsive`.
           If using a custom layout, ensure the structure is compatible or adjust.
           The example below tries to follow a common pattern.
        */

        main.responsive { /* This is a common BeerCSS pattern for main content area */
            padding: 0; /* Remove padding if drawer handles it or content adds its own */
        }

        /* Drawer styling */
        nav.drawer { /* Assuming this is the drawer element itself */
            /* BeerCSS provides most drawer styles. Customizations here if needed. */
            /* Example: Adjust width if the default 250px/280px is not desired */
            /* width: 300px; */
            /* min-width: 260px; */
        }

        nav.drawer a.wave {
            border-radius: 0 var(--round) var(--round) 0; /* Standard BeerCSS styling for drawer links */
            padding: 0.75rem 1rem; /* Adjust padding if needed */
        }

        nav.drawer a.active, /* BeerCSS might use .active or similar */
        nav.drawer a.active.wave {
             background-color: var(--primary-container);
             color: var(--on-primary-container);
        }
        nav.drawer a.active i,
        nav.drawer a.active.wave i {
            color: var(--on-primary-container);
        }

        /* Main content area that shifts with the drawer */
        .content-container {
            padding: 1rem; /* Padding for the actual content */
            overflow-y: auto;
            height: calc(100vh - 56px); /* Full height minus header */
            /* BeerCSS might apply margin-left when drawer is open and not 'fixed' */
        }


        .content-card {
            margin-bottom: 1.5rem;
            background-color: var(--surface-container);
        }
        .content-section-title {
            border-bottom: 2px solid var(--outline-variant);
            padding-bottom: 0.5rem;
            margin-bottom: 1.5rem;
            margin-top:0;
            color: var(--primary);
        }
        .field {
            margin-bottom: 1.5rem;
        }
        .char-options-label {
            font-weight: bold;
            display: block;
            margin-bottom: 0.75rem;
        }
        .char-options-group {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 1.5rem;
        }
        .char-options-group > label.checkbox,
        .char-options-group > .field.select {
            margin-bottom: 0;
        }
        .char-options-group > .field.select {
            min-width: 180px;
            flex-grow: 0;
        }

        #resultTableCombined th, #resultTableCombined td {
            padding: 0.75rem;
            text-align: left;
        }
        #errorMessageCombined.chip,
        #errorMessageIdOnly.chip,
        #errorMessagePinOnly.chip {
            margin-bottom: 1rem;
            padding: 0.75rem 1rem;
        }
        .hidden {
            display: none !important;
        }
        .result-actions button {
            margin-right: 0.5rem;
            margin-bottom: 1rem;
        }
        .standalone-result-area textarea {
            min-height: 150px;
            width: 100%;
            padding: 8px;
            border: 1px solid var(--outline);
            border-radius: var(--border-radius);
            font-family: var(--font-monospace, monospace);
        }
    </style>
</head>
<body data-theme="light" class="responsive"> <!-- Added .responsive to body for BeerCSS layouts -->

    <header class="fixed"> <!-- Header should be outside the main.responsive that contains drawer + content -->
        <nav>
            <button data-ui="#main-drawer" class="circle transparent"> <!-- data-ui targets the drawer -->
                <i>menu</i>
            </button>
            <h5 class="max">ID・PIN生成アプリ</h5>
            <!-- <div class="max"></div> Optional: to push things to the right -->
        </nav>
    </header>

    <!--
        BeerCSS typically expects a structure like:
        <body>
            <header>...</header>
            <main class="responsive">  <-- or other layout container
                <nav id="main-drawer" class="drawer">...</nav>
                <div class="content">...</div>  <-- or directly the content
            </main>
            <footer>...</footer>
        </body>
    -->

    <main class="responsive"> <!-- This main will contain both drawer and content area -->
        <nav id="main-drawer" class="drawer"> <!-- Drawer - ID is important for data-ui -->
            <a href="#" data-target="id-pin-generator-section" class="wave active">
                <i>list_alt</i>
                <span>ID / PIN 作成</span>
            </a>
            <a href="#" data-target="id-generator-section" class="wave">
                <i>pin</i>
                <span>ID 作成</span>
            </a>
            <a href="#" data-target="pin-generator-section" class="wave">
                <i>password</i>
                <span>PIN 作成</span>
            </a>
        </nav>

        <div class="content-container"> <!-- This div will be the main scrollable content area -->
            <!-- Section 1: ID / PIN 作成 (既存機能) -->
            <section id="id-pin-generator-section" class="content-section">
                <article id="error-card-combined" class="content-card large-padding hidden">
                     <div id="errorMessageCombined" class="chip red white-text"></div>
                </article>

                <article class="content-card large-padding">
                    <h2 class="large-title content-section-title">入力情報 (ID & PIN)</h2>
                    <div class="field textarea label border">
                        <textarea id="studentNumbers" placeholder="例:
1001
1002
1003"></textarea>
                        <label>生徒番号 (改行区切り)</label>
                        <span></span><i></i>
                    </div>
                </article>

                <article class="content-card large-padding">
                    <h3 class="medium-title primary-text" style="margin-top:0; margin-bottom: 1rem;">ID生成条件</h3>
                    <div class="field numeric label border">
                        <input type="number" id="idLengthCombined" value="8" min="1">
                        <label>桁数</label>
                        <span></span><i></i>
                    </div>
                    <div>
                        <label class="char-options-label">使用文字:</label>
                        <div class="char-options-group">
                            <label class="checkbox"><input type="checkbox" id="idUseDigitsCombined" checked><span>数字</span></label>
                            <div class="field select label border">
                                <select id="idAlphabetOptionCombined">
                                    <option value="none">使用しない</option>
                                    <option value="upper" selected>大文字のみ</option>
                                    <option value="lower">小文字のみ</option>
                                    <option value="both">両方</option>
                                </select>
                                <label>アルファベット</label><span></span><i></i>
                            </div>
                            <label class="checkbox"><input type="checkbox" id="idUseSymbolsCombined"><span>記号</span></label>
                        </div>
                    </div>
                </article>

                <article class="content-card large-padding">
                    <h3 class="medium-title primary-text" style="margin-top:0; margin-bottom: 1rem;">PIN生成条件</h3>
                     <div class="field numeric label border">
                        <input type="number" id="pinLengthCombined" value="4" min="1">
                        <label>桁数</label>
                        <span></span><i></i>
                    </div>
                    <div>
                        <label class="char-options-label">使用文字:</label>
                         <div class="char-options-group">
                            <label class="checkbox"><input type="checkbox" id="pinUseDigitsCombined" checked><span>数字</span></label>
                            <div class="field select label border">
                                <select id="pinAlphabetOptionCombined">
                                    <option value="none">使用しない</option>
                                    <option value="upper">大文字のみ</option>
                                    <option value="lower">小文字のみ</option>
                                    <option value="both" selected>両方</option>
                                </select>
                                <label>アルファベット</label><span></span><i></i>
                            </div>
                            <label class="checkbox"><input type="checkbox" id="pinUseSymbolsCombined"><span>記号</span></label>
                        </div>
                    </div>
                </article>

                <article class="content-card large-padding" style="background-color: transparent; box-shadow: none;">
                    <button id="generateButtonCombined" class="responsive primary"><span>実行</span><i class="material-icons">play_arrow</i></button>
                </article>

                <article id="resultAreaCombined" class="content-card large-padding hidden">
                    <h2 class="large-title content-section-title">生成結果 (ID & PIN)</h2>
                    <div class="result-actions">
                        <button id="toggleResultButtonCombined" class="secondary"><span>結果を隠す</span><i class="material-icons">visibility_off</i></button>
                        <button id="downloadCsvButtonCombined" class="tertiary"><span>CSVダウンロード</span><i class="material-icons">download</i></button>
                    </div>
                    <div class="responsive-table">
                        <table id="resultTableCombined" class="stripes">
                            <thead><tr><th>生徒番号</th><th>ID</th><th>PIN</th></tr></thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </article>
            </section>

            <!-- Section 2: ID 作成 (新規機能) -->
            <section id="id-generator-section" class="content-section hidden">
                <article id="error-card-id-only" class="content-card large-padding hidden">
                     <div id="errorMessageIdOnly" class="chip red white-text"></div>
                </article>

                <article class="content-card large-padding">
                    <h2 class="large-title content-section-title">ID 生成</h2>
                    <div class="field numeric label border">
                        <input type="number" id="idCountIdOnly" value="10" min="1">
                        <label>生成する個数</label>
                        <span></span><i></i>
                    </div>
                    <div class="field numeric label border">
                        <input type="number" id="idLengthIdOnly" value="8" min="1">
                        <label>桁数</label>
                        <span></span><i></i>
                    </div>
                    <div>
                        <label class="char-options-label">使用文字:</label>
                        <div class="char-options-group">
                            <label class="checkbox"><input type="checkbox" id="idUseDigitsIdOnly" checked><span>数字</span></label>
                            <div class="field select label border">
                                <select id="idAlphabetOptionIdOnly">
                                    <option value="none">使用しない</option>
                                    <option value="upper" selected>大文字のみ</option>
                                    <option value="lower">小文字のみ</option>
                                    <option value="both">両方</option>
                                </select>
                                <label>アルファベット</label><span></span><i></i>
                            </div>
                            <label class="checkbox"><input type="checkbox" id="idUseSymbolsIdOnly"><span>記号</span></label>
                        </div>
                    </div>
                </article>
                 <article class="content-card large-padding" style="background-color: transparent; box-shadow: none;">
                    <button id="generateButtonIdOnly" class="responsive primary"><span>ID生成実行</span><i class="material-icons">play_arrow</i></button>
                </article>
                <article id="resultAreaIdOnly" class="content-card large-padding hidden">
                    <h2 class="large-title content-section-title">生成されたIDリスト</h2>
                    <div class="result-actions">
                         <button id="downloadCsvButtonIdOnly" class="tertiary"><span>IDリストCSVダウンロード</span><i class="material-icons">download</i></button>
                    </div>
                    <div class="standalone-result-area">
                        <textarea id="idResultTextarea" readonly></textarea>
                    </div>
                </article>
            </section>

            <!-- Section 3: PIN 作成 (新規機能) -->
            <section id="pin-generator-section" class="content-section hidden">
                 <article id="error-card-pin-only" class="content-card large-padding hidden">
                     <div id="errorMessagePinOnly" class="chip red white-text"></div>
                </article>

                <article class="content-card large-padding">
                    <h2 class="large-title content-section-title">PIN 生成</h2>
                     <div class="field numeric label border">
                        <input type="number" id="pinCountPinOnly" value="10" min="1">
                        <label>生成する個数</label>
                        <span></span><i></i>
                    </div>
                    <div class="field numeric label border">
                        <input type="number" id="pinLengthPinOnly" value="4" min="1">
                        <label>桁数</label>
                        <span></span><i></i>
                    </div>
                    <div>
                        <label class="char-options-label">使用文字:</label>
                        <div class="char-options-group">
                            <label class="checkbox"><input type="checkbox" id="pinUseDigitsPinOnly" checked><span>数字</span></label>
                            <div class="field select label border">
                                <select id="pinAlphabetOptionPinOnly">
                                    <option value="none">使用しない</option>
                                    <option value="upper">大文字のみ</option>
                                    <option value="lower">小文字のみ</option>
                                    <option value="both" selected>両方</option>
                                </select>
                                <label>アルファベット</label><span></span><i></i>
                            </div>
                            <label class="checkbox"><input type="checkbox" id="pinUseSymbolsPinOnly"><span>記号</span></label>
                        </div>
                    </div>
                </article>
                <article class="content-card large-padding" style="background-color: transparent; box-shadow: none;">
                    <button id="generateButtonPinOnly" class="responsive primary"><span>PIN生成実行</span><i class="material-icons">play_arrow</i></button>
                </article>
                <article id="resultAreaPinOnly" class="content-card large-padding hidden">
                    <h2 class="large-title content-section-title">生成されたPINリスト</h2>
                    <div class="result-actions">
                        <button id="downloadCsvButtonPinOnly" class="tertiary"><span>PINリストCSVダウンロード</span><i class="material-icons">download</i></button>
                    </div>
                     <div class="standalone-result-area">
                        <textarea id="pinResultTextarea" readonly></textarea>
                    </div>
                </article>
            </section>
        </div> <!-- End of .content-container -->
    </main> <!-- End of main.responsive -->

    <!-- BeerCSS JavaScript (should be at the end of body) -->
    <script type="module" src="https://cdn.jsdelivr.net/npm/beercss@3.5.1/dist/beercss.min.js"></script>
    <script>
        // --- Common Utility Functions ---
        const CHARSETS = {
            digits: '0123456789',
            alphabetUpper: 'ABCDEFGHIJKLMNOPQRSTUVWXYZ',
            alphabetLower: 'abcdefghijklmnopqrstuvwxyz',
            symbols: '!@#$%^&*()_+-=[]{};\':",./<>?'
        };

        function generateRandomString(length, charSet) {
            let result = '';
            const charSetLength = charSet.length;
            if (charSetLength === 0) return '';
            const randomValues = new Uint32Array(length);
            crypto.getRandomValues(randomValues);
            for (let i = 0; i < length; i++) {
                result += charSet.charAt(randomValues[i] % charSetLength);
            }
            return result;
        }

        function getCharSet(useDigits, alphabetOption, useSymbols) {
            let charSet = '';
            if (useDigits) charSet += CHARSETS.digits;
            if (alphabetOption === 'upper') charSet += CHARSETS.alphabetUpper;
            else if (alphabetOption === 'lower') charSet += CHARSETS.alphabetLower;
            else if (alphabetOption === 'both') charSet += CHARSETS.alphabetUpper + CHARSETS.alphabetLower;
            if (useSymbols) charSet += CHARSETS.symbols;
            return charSet;
        }

        function downloadCsv(filename, headers, dataArray) {
            if (dataArray.length === 0) {
                ui.toast("ダウンロードするデータがありません。", 3000); // Using BeerCSS toast
                return;
            }
            let csvContent = headers.join(",") + "\n";
            dataArray.forEach(item => {
                if (typeof item === 'object') {
                    const studentNumber = `"${String(item.studentNumber).replace(/"/g, '""')}"`;
                    const id = `"${String(item.id).replace(/"/g, '""')}"`;
                    const pin = `"${String(item.pin).replace(/"/g, '""')}"`;
                    csvContent += [studentNumber, id, pin].join(",") + "\n";
                } else {
                    const value = `"${String(item).replace(/"/g, '""')}"`;
                    csvContent += value + "\n";
                }
            });
            const bom = new Uint8Array([0xEF, 0xBB, 0xBF]);
            const blob = new Blob([bom, csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement("a");
            link.setAttribute("href", url);
            link.setAttribute("download", filename);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        }

        // --- Navigation Logic ---
        const drawerNav = document.getElementById('main-drawer');
        const drawerLinks = drawerNav.querySelectorAll('a');
        const contentSections = document.querySelectorAll('.content-container > .content-section'); // Target sections inside content-container

        drawerLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const targetId = link.dataset.target;

                contentSections.forEach(section => {
                    section.classList.add('hidden');
                });
                const targetSection = document.getElementById(targetId);
                if (targetSection) {
                    targetSection.classList.remove('hidden');
                }


                drawerLinks.forEach(l => l.classList.remove('active'));
                link.classList.add('active');
                
                // For non-fixed drawers or drawers that don't auto-close on item click on mobile:
                // Programmatically close the drawer if it's open (usually for mobile view)
                // This depends on how BeerCSS handles drawer state.
                // If data-ui="#main-drawer" on the button makes the drawer an overlay on small screens,
                // clicking a link might not auto-close it.
                if (window.innerWidth < 960) { // Example breakpoint for mobile drawer behavior
                     ui('#main-drawer', 'close'); // Programmatically close drawer
                }
            });
        });

        // --- Section 1: ID / PIN 作成 (Combined) ---
        const studentNumbersInput = document.getElementById('studentNumbers');
        const idLengthCombinedInput = document.getElementById('idLengthCombined');
        const idUseDigitsCombinedCheckbox = document.getElementById('idUseDigitsCombined');
        const idAlphabetOptionCombinedSelect = document.getElementById('idAlphabetOptionCombined');
        const idUseSymbolsCombinedCheckbox = document.getElementById('idUseSymbolsCombined');
        const pinLengthCombinedInput = document.getElementById('pinLengthCombined');
        const pinUseDigitsCombinedCheckbox = document.getElementById('pinUseDigitsCombined');
        const pinAlphabetOptionCombinedSelect = document.getElementById('pinAlphabetOptionCombined');
        const pinUseSymbolsCombinedCheckbox = document.getElementById('pinUseSymbolsCombined');
        const generateButtonCombined = document.getElementById('generateButtonCombined');
        const resultAreaCombined = document.getElementById('resultAreaCombined');
        const toggleResultButtonCombined = document.getElementById('toggleResultButtonCombined');
        const downloadCsvButtonCombined = document.getElementById('downloadCsvButtonCombined');
        const resultTableBodyCombined = document.querySelector('#resultTableCombined tbody');
        const errorCardCombined = document.getElementById('error-card-combined');
        const errorMessageCombinedDiv = document.getElementById('errorMessageCombined');
        let generatedDataCombined = [];

        function displayErrorCombined(message) {
            errorMessageCombinedDiv.textContent = message;
            errorCardCombined.classList.toggle('hidden', !message);
        }

        function validateInputsCombined() {
            let msg = '';
            const studentNumbers = studentNumbersInput.value.trim().split('\n').filter(sn => sn.trim() !== '');
            if (studentNumbers.length === 0 && studentNumbersInput.value.trim() !== '') {
                // If there was input but it was all whitespace/empty lines
                msg += '有効な生徒番号を入力してください。\n';
            } else if (studentNumbers.length === 0) {
                 msg += '生徒番号を入力してください。\n';
            }

            if (isNaN(parseInt(idLengthCombinedInput.value)) || parseInt(idLengthCombinedInput.value) < 1) msg += 'IDの桁数は1以上の数値を指定してください。\n';
            if (getCharSet(idUseDigitsCombinedCheckbox.checked, idAlphabetOptionCombinedSelect.value, idUseSymbolsCombinedCheckbox.checked).length === 0) msg += 'ID生成に使用する文字種を少なくとも1つ選択してください。\n';
            if (isNaN(parseInt(pinLengthCombinedInput.value)) || parseInt(pinLengthCombinedInput.value) < 1) msg += 'PINの桁数は1以上の数値を指定してください。\n';
            if (getCharSet(pinUseDigitsCombinedCheckbox.checked, pinAlphabetOptionCombinedSelect.value, pinUseSymbolsCombinedCheckbox.checked).length === 0) msg += 'PIN生成に使用する文字種を少なくとも1つ選択してください。\n';
            
            displayErrorCombined(msg.trim());
            return msg === '';
        }
        
        generateButtonCombined.addEventListener('click', () => {
            displayErrorCombined('');
            if (!validateInputsCombined()) {
                resultAreaCombined.classList.add('hidden');
                return;
            }
            const studentNumbers = studentNumbersInput.value.trim().split('\n').map(s => s.trim()).filter(s => s !== '');
            const idLength = parseInt(idLengthCombinedInput.value);
            const idCharSet = getCharSet(idUseDigitsCombinedCheckbox.checked, idAlphabetOptionCombinedSelect.value, idUseSymbolsCombinedCheckbox.checked);
            const pinLength = parseInt(pinLengthCombinedInput.value);
            const pinCharSet = getCharSet(pinUseDigitsCombinedCheckbox.checked, pinAlphabetOptionCombinedSelect.value, pinUseSymbolsCombinedCheckbox.checked);

            generatedDataCombined = [];
            resultTableBodyCombined.innerHTML = '';
            const generatedIds = new Set();
            let generationError = null;

            try {
                for (const studentNumber of studentNumbers) {
                    let id;
                    let attempts = 0;
                    const maxAttempts = Math.max(studentNumbers.length * 10, 5000);
                    do {
                        id = generateRandomString(idLength, idCharSet);
                        attempts++;
                        if (attempts > maxAttempts) { generationError = `一意のIDを生成できませんでした(${studentNumber}付近)。桁数や文字種を見直してください。`; break; }
                    } while (generatedIds.has(id));
                    if (generationError) break;
                    generatedIds.add(id);
                    const pin = generateRandomString(pinLength, pinCharSet);
                    generatedDataCombined.push({ studentNumber, id, pin });
                    const row = resultTableBodyCombined.insertRow();
                    row.insertCell().textContent = studentNumber;
                    row.insertCell().textContent = id;
                    row.insertCell().textContent = pin;
                }
            } catch (error) { generationError = `予期せぬエラーが発生しました: ${error.message}`; }

            if (generationError) { displayErrorCombined(generationError); resultAreaCombined.classList.add('hidden'); return; }
            if (generatedDataCombined.length > 0) {
                resultAreaCombined.classList.remove('hidden');
                document.getElementById('resultTableCombined').classList.remove('hidden');
                downloadCsvButtonCombined.classList.remove('hidden');
                toggleResultButtonCombined.querySelector('span').textContent = '結果を隠す';
                toggleResultButtonCombined.querySelector('i').textContent = 'visibility_off';
            } else { displayErrorCombined('データが生成されませんでした。入力内容を確認してください。'); resultAreaCombined.classList.add('hidden');}
        });
        toggleResultButtonCombined.addEventListener('click', () => {
            const table = document.getElementById('resultTableCombined');
            const csvBtn = downloadCsvButtonCombined;
            const icon = toggleResultButtonCombined.querySelector('i');
            const span = toggleResultButtonCombined.querySelector('span');
            const isHidden = table.classList.toggle('hidden');
            csvBtn.classList.toggle('hidden', isHidden);
            if (isHidden) { span.textContent = '結果を表示'; icon.textContent = 'visibility'; }
            else { span.textContent = '結果を隠す'; icon.textContent = 'visibility_off'; }
        });
        downloadCsvButtonCombined.addEventListener('click', () => {
            downloadCsv("id_pin_list_combined.csv", ["生徒番号", "ID", "PIN"], generatedDataCombined);
        });


        // --- Section 2: ID 作成 (Standalone) ---
        const idCountIdOnlyInput = document.getElementById('idCountIdOnly');
        const idLengthIdOnlyInput = document.getElementById('idLengthIdOnly');
        const idUseDigitsIdOnlyCheckbox = document.getElementById('idUseDigitsIdOnly');
        const idAlphabetOptionIdOnlySelect = document.getElementById('idAlphabetOptionIdOnly');
        const idUseSymbolsIdOnlyCheckbox = document.getElementById('idUseSymbolsIdOnly');
        const generateButtonIdOnly = document.getElementById('generateButtonIdOnly');
        const resultAreaIdOnly = document.getElementById('resultAreaIdOnly');
        const idResultTextarea = document.getElementById('idResultTextarea');
        const downloadCsvButtonIdOnly = document.getElementById('downloadCsvButtonIdOnly');
        const errorCardIdOnly = document.getElementById('error-card-id-only');
        const errorMessageIdOnlyDiv = document.getElementById('errorMessageIdOnly');
        let generatedIdsOnly = [];

        function displayErrorIdOnly(message) {
            errorMessageIdOnlyDiv.textContent = message;
            errorCardIdOnly.classList.toggle('hidden', !message);
        }
        function validateInputsIdOnly() {
            let msg = '';
            if (isNaN(parseInt(idCountIdOnlyInput.value)) || parseInt(idCountIdOnlyInput.value) < 1) msg += '生成する個数は1以上の数値を指定してください。\n';
            if (isNaN(parseInt(idLengthIdOnlyInput.value)) || parseInt(idLengthIdOnlyInput.value) < 1) msg += 'IDの桁数は1以上の数値を指定してください。\n';
            if (getCharSet(idUseDigitsIdOnlyCheckbox.checked, idAlphabetOptionIdOnlySelect.value, idUseSymbolsIdOnlyCheckbox.checked).length === 0) msg += 'ID生成に使用する文字種を少なくとも1つ選択してください。\n';
            displayErrorIdOnly(msg.trim());
            return msg === '';
        }

        generateButtonIdOnly.addEventListener('click', () => {
            displayErrorIdOnly('');
            if(!validateInputsIdOnly()) { resultAreaIdOnly.classList.add('hidden'); return; }
            const count = parseInt(idCountIdOnlyInput.value);
            const length = parseInt(idLengthIdOnlyInput.value);
            const charSet = getCharSet(idUseDigitsIdOnlyCheckbox.checked, idAlphabetOptionIdOnlySelect.value, idUseSymbolsIdOnlyCheckbox.checked);
            generatedIdsOnly = [];
            for (let i = 0; i < count; i++) {
                generatedIdsOnly.push(generateRandomString(length, charSet));
            }
            idResultTextarea.value = generatedIdsOnly.join('\n');
            resultAreaIdOnly.classList.remove('hidden');
        });
        downloadCsvButtonIdOnly.addEventListener('click', () => {
            downloadCsv("id_list.csv", ["ID"], generatedIdsOnly);
        });

        // --- Section 3: PIN 作成 (Standalone) ---
        const pinCountPinOnlyInput = document.getElementById('pinCountPinOnly');
        const pinLengthPinOnlyInput = document.getElementById('pinLengthPinOnly');
        const pinUseDigitsPinOnlyCheckbox = document.getElementById('pinUseDigitsPinOnly');
        const pinAlphabetOptionPinOnlySelect = document.getElementById('pinAlphabetOptionPinOnly');
        const pinUseSymbolsPinOnlyCheckbox = document.getElementById('pinUseSymbolsPinOnly');
        const generateButtonPinOnly = document.getElementById('generateButtonPinOnly');
        const resultAreaPinOnly = document.getElementById('resultAreaPinOnly');
        const pinResultTextarea = document.getElementById('pinResultTextarea');
        const downloadCsvButtonPinOnly = document.getElementById('downloadCsvButtonPinOnly');
        const errorCardPinOnly = document.getElementById('error-card-pin-only');
        const errorMessagePinOnlyDiv = document.getElementById('errorMessagePinOnly');
        let generatedPinsOnly = [];

        function displayErrorPinOnly(message) {
            errorMessagePinOnlyDiv.textContent = message;
            errorCardPinOnly.classList.toggle('hidden', !message);
        }
         function validateInputsPinOnly() {
            let msg = '';
            if (isNaN(parseInt(pinCountPinOnlyInput.value)) || parseInt(pinCountPinOnlyInput.value) < 1) msg += '生成する個数は1以上の数値を指定してください。\n';
            if (isNaN(parseInt(pinLengthPinOnlyInput.value)) || parseInt(pinLengthPinOnlyInput.value) < 1) msg += 'PINの桁数は1以上の数値を指定してください。\n';
            if (getCharSet(pinUseDigitsPinOnlyCheckbox.checked, pinAlphabetOptionPinOnlySelect.value, pinUseSymbolsPinOnlyCheckbox.checked).length === 0) msg += 'PIN生成に使用する文字種を少なくとも1つ選択してください。\n';
            displayErrorPinOnly(msg.trim());
            return msg === '';
        }

        generateButtonPinOnly.addEventListener('click', () => {
            displayErrorPinOnly('');
            if(!validateInputsPinOnly()) { resultAreaPinOnly.classList.add('hidden'); return; }
            const count = parseInt(pinCountPinOnlyInput.value);
            const length = parseInt(pinLengthPinOnlyInput.value);
            const charSet = getCharSet(pinUseDigitsPinOnlyCheckbox.checked, pinAlphabetOptionPinOnlySelect.value, pinUseSymbolsPinOnlyCheckbox.checked);
            generatedPinsOnly = [];
            for (let i = 0; i < count; i++) {
                generatedPinsOnly.push(generateRandomString(length, charSet));
            }
            pinResultTextarea.value = generatedPinsOnly.join('\n');
            resultAreaPinOnly.classList.remove('hidden');
        });
        downloadCsvButtonPinOnly.addEventListener('click', () => {
            downloadCsv("pin_list.csv", ["PIN"], generatedPinsOnly);
        });

        // Initial setup
        document.addEventListener('DOMContentLoaded', () => {
            contentSections.forEach((section, index) => {
                if (index !== 0) section.classList.add('hidden');
            });
            const tableCombined = document.getElementById('resultTableCombined');
            if (tableCombined && tableCombined.classList.contains('hidden')) { // Check if element exists
                 const btnToggle = toggleResultButtonCombined;
                 if(btnToggle) { // Check if button exists
                    btnToggle.querySelector('span').textContent = '結果を表示';
                    btnToggle.querySelector('i').textContent = 'visibility';
                 }
            }
            // BeerCSS might initialize components automatically.
            // If not, you might need: ui();
        });
    </script>
</body>
</html>